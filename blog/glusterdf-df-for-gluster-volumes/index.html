
<!DOCTYPE HTML>
<html lang="en">
    <head>
    <meta charset="utf-8">
    
    <title>glusterdf - df for gluster volumes - Aravinda Vishwanathapura</title>
    
    <meta name="generator" content="Nanoc 4.12.10">
    <link rel="apple-touch-icon" sizes="300x300" href="/images/me_fav.png">
    <link rel="icon" type="image/png" sizes="300x300" href="/images/me_fav.png">
    <link rel="stylesheet" href="/bulma-0.9.4.min.css">
    <link rel="stylesheet" href="/pygment-emacs-highlight.css">
    <link rel="stylesheet" href="/stylesheet.css">
    <script defer src="/alpinejs-3.10.5.min.js"></script>
    
    <meta property="og:title" content="glusterdf - df for gluster volumes"/>
    <meta name="author" content=""/>
    <meta property="og:locale" content="en_US"/>
    <meta name="description" content="A CLI utility to check the disk usage of glusterfs volumes"/>
    <meta property="og:description" content="A CLI utility to check the disk usage of glusterfs volumes"/>
    <link rel="canonical" href="/blog/glusterdf-df-for-gluster-volumes/"/>
    <meta property="og:url" content="/blog/glusterdf-df-for-gluster-volumes/"/>
    <meta property="og:site_name" content="Aravinda Vishwanathapura"/>
    <meta property="og:type" content="article"/>
    <meta property="article:published_time" content="2013-09-24"/>
    
    <meta name="twitter:card" content="summary"/>
    <meta property="og:image" content="https://aravindavk.in/images/me.jpg"/>
    <meta name="twitter:image" content="https://aravindavk.in/images/me.jpg"/>
    
    <meta name="twitter:site" content="https://aravindavk.in"/>
    <meta name="twitter:title" content="glusterdf - df for gluster volumes"/>
    <meta name="twitter:description" content="A CLI utility to check the disk usage of glusterfs volumes"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script defer data-domain="aravindavk.in" src="https://plausible.io/js/plausible.js"></script>
</head>

    <body>
        <div id="main" class="container is-max-desktop px-4">
            <nav class="has-text-centered mb-6">
    <a class="link is-info is-inline-block px-2" href="/blog">Blog Posts</a>
    <a class="link is-info is-inline-block px-2" href="/talks-articles">Talks & Articles</a>
    <a class="link is-info is-inline-block px-2" href="/projects">Projects</a>
</nav>
<div class="has-text-centered py-6">
    <a href="/">
        <figure class="image is-64x64" style="margin: auto">
            <img class="is-rounded" src="/images/me.jpg">
        </figure>
        <p class="has-text-grey pb-6 is-size-6">ARAVINDA VISHWANATHAPURA</p>
    </a>
</div>

            <div class="has-text-centered">
                <h1 class="title">glusterdf - df for gluster volumes</h1>
                <div class="">Sep 24, 2013</div>
                <div class="">
                    <span class="icon-text">
                        <svg class="mr-1 icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path></svg>
                        <span><strong>2 minutes</strong> read.</span>
                    </span>
                </div>
                <div>
                    
                    <span class="tag is-info is-light">glusterfs</span>
                    
                    <span class="tag is-info is-light">tools</span>
                    
                    <span class="tag is-info is-light">glusterfsblog</span>
                    
                </div>
            </div>
            <div class="content py-6">
                <div class="paragraph">
<p>A CLI utility to check the disk usage of <a href="http://gluster.org/">Gluster</a> volumes. Using <code>df</code> command we can view the disk usage of only mounted glusterfs volumes. This utility takes care of mounting gluster volumes available in the machine where this command is executed. glusterdf uses <a href="https://github.com/gluster/glusterfs/tree/master/api">libgfapi</a> provided by glusterfs to fetch the statvfs information.</p>
</div>
<div class="paragraph">
<p>Installation is very simple,</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">git clone https://github.com/aravindavk/glusterfs-tools.git
<span class="nb">cd </span>glusterfs-tools
<span class="nb">sudo </span>python setup.py <span class="nb">install</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>You can also clone this project from <a href="https://forge.gluster.org/glusterfs-tools" class="bare">https://forge.gluster.org/glusterfs-tools</a></p>
</div>
<div class="paragraph">
<p>Once installed, two tools will be available <code>glustervolumes</code> and <code>glusterdf</code>.</p>
</div>
<div class="paragraph">
<p><code>sudo glusterdf --help</code> to know more about options available. (same for glustervolumes <code>sudo glustervolumes --help</code>)</p>
</div>
<div class="paragraph">
<p>Usage examples:</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/glusterfs/glusterdf_h.png" alt="glusterdf -h">
</div>
<div class="title">sudo glusterdf -h (Disk usage in human readable format)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/glusterfs/glusterdf_i.png" alt="glusterdf -i">
</div>
<div class="title">sudo glusterdf -i (View inodes usage information)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/glusterfs/glusterdf_status_type_h.png" alt="sudo glusterdf --status up --type repl -h">
</div>
<div class="title">sudo glusterdf --status up --type repl -h (View all running replicated volumes)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/glusterfs/glusterdf_volumewithbrick.png" alt="sudo glusterdf -h --volumewithbrick &quot;/b[12]&quot;">
</div>
<div class="title">sudo glusterdf -h --volumewithbrick "/b[12]"</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/glusterfs/glusterdf_json.png" alt="sudo glusterdf --status up --type repli -h --json | python -m json.tool">
</div>
<div class="title">sudo glusterdf --status up --type repli -h --json | python -m json.tool</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/glusterfs/glusterdf-help.png" alt="glusterdf --help">
</div>
<div class="title">sudo glusterdf --help</div>
</div>
<div class="paragraph">
<p>In my previous blog(<a href="http://aravindavk.in/blog/glusterfs-tools/">this</a>) I wrote about gfvolumes(now it is <code>glustervolumes</code>). glusterfs-tools is rewritten as python library which can be used with your Python programs.</p>
</div>
<div class="paragraph">
<p>For example</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="kn">from</span> <span class="nn">glusterfstools</span> <span class="kn">import</span> <span class="n">volumes</span><span class="p">,</span> <span class="n">gfapi</span>
<span class="c1"># Get all volumes
</span><span class="n">vols</span> <span class="o">=</span> <span class="n">volumes</span><span class="p">.</span><span class="n">get</span><span class="p">()</span>
<span class="c1"># Get a specific volume information
</span><span class="n">vol</span> <span class="o">=</span> <span class="n">volumes</span><span class="p">.</span><span class="n">get</span><span class="p">(</span><span class="n">name</span><span class="o">=</span><span class="s">"gv1"</span><span class="p">)</span>
<span class="c1"># Search volumes by status
</span><span class="n">down_volumes</span> <span class="o">=</span> <span class="n">volumes</span><span class="p">.</span><span class="n">search</span><span class="p">({</span><span class="s">"status"</span><span class="p">:</span> <span class="s">"down"</span><span class="p">})</span>
<span class="c1"># Search volumes by type
</span><span class="n">distribute_volumes</span> <span class="o">=</span> <span class="n">volumes</span><span class="p">.</span><span class="n">search</span><span class="p">({</span><span class="s">"type"</span><span class="p">:</span> <span class="s">"distribute"</span><span class="p">})</span>
<span class="c1"># Statvfs information
</span><span class="n">vol_statvfs</span> <span class="o">=</span> <span class="n">gfapi</span><span class="p">.</span><span class="n">statvfs</span><span class="p">(</span><span class="s">"gv1"</span><span class="p">)</span>
<span class="c1"># To view information about gluster volumes which are down
# and having bricks like "/gfs"
</span><span class="n">vols</span> <span class="o">=</span> <span class="n">volumes</span><span class="p">.</span><span class="n">search</span><span class="p">({</span><span class="s">"status"</span><span class="p">:</span> <span class="s">"down"</span><span class="p">,</span> <span class="s">"volumewithbricks"</span><span class="p">:</span> <span class="s">"/gfs"</span><span class="p">})</span>
<span class="c1"># To view filters available
</span><span class="k">print</span> <span class="p">(</span><span class="n">volumes</span><span class="p">.</span><span class="n">filters</span><span class="p">())</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>volumes.search accepts filters as parameter, extending volume filters is very simple. For example name filter looks like this(<a href="https://github.com/aravindavk/glusterfs-tools/blob/master/src/glusterfstools/volumefilters.py">src/glusterfstools/volumefilters.py</a>)</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="o">@</span><span class="nb">filter</span><span class="p">(</span><span class="s">"name"</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">name_filter</span><span class="p">(</span><span class="n">vols</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">is_match</span><span class="p">(</span><span class="n">vol</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">value</span> <span class="ow">in</span> <span class="p">[</span><span class="s">''</span><span class="p">,</span> <span class="s">'all'</span><span class="p">]</span> <span class="ow">or</span> \
            <span class="n">vol</span><span class="p">[</span><span class="s">"name"</span><span class="p">].</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="n">value</span><span class="p">.</span><span class="n">lower</span><span class="p">().</span><span class="n">strip</span><span class="p">()</span> <span class="ow">or</span> \
            <span class="n">re</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="n">value</span><span class="p">,</span> <span class="n">vol</span><span class="p">[</span><span class="s">"name"</span><span class="p">]):</span>
            <span class="k">return</span> <span class="bp">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="bp">False</span>

    <span class="k">return</span> <span class="p">[</span><span class="n">v</span> <span class="k">for</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">vols</span> <span class="k">if</span> <span class="n">is_match</span><span class="p">(</span><span class="n">v</span><span class="p">,</span> <span class="n">value</span><span class="p">)]</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>The filter can be used as below</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="python"><span class="kn">from</span> <span class="nn">glusterfstools</span> <span class="kn">import</span> <span class="n">volumes</span>

<span class="c1"># Filters the volumes with name either gv1 or gv2
</span><span class="n">filters</span> <span class="o">=</span> <span class="p">{</span><span class="s">"name"</span><span class="p">:</span> <span class="s">"gv[12]"</span><span class="p">}</span>
<span class="k">print</span> <span class="n">volumes</span><span class="p">.</span><span class="n">search</span><span class="p">(</span><span class="n">filters</span><span class="p">)</span></code></pre>
</div>
</div>
            </div>
            <div class="has-text-centered mb-6 notification  is-light">
    
    <p class="has-text-grey is-uppercase is-size-5 pb-2">About Aravinda Vishwanathapura</p>
    
    Co-Founder & CTO at <a href="https://kadalu.tech">Kadalu Technologies</a>,
    Creator of <a href="https://aravindavk.in/sanka">Sanka</a>,
    Creator of <a href="https://aravindavk.in/chitra">Chitra</a>,
    <a href="https://gluster.org">GlusterFS</a> core team member,
    Maintainer of <a href="https://github.com/kadalu">Kadalu Storage</a>
    <div class="mt-6">
        Contact:
        <a href="http://in.linkedin.com/in/aravindavk">Linkedin</a> |
        <a href="https://twitter.com/aravindavk">Twitter</a> |
        <a href="http://facebook.com/aravindavk">Facebook</a> |
        <a href="https://github.com/aravindavk">Github</a> |
        mail&#64;&#97;&#114;&#97;&#118;&#105;&#110;&#100;&#97;&#118;&#107;&#46;&#105;&#110;
    </div>
</div>

        </div>
        <footer class="footer has-background-white-bis mt-6">
    <div class="content has-text-centered">
        <p>
            Copyright &copy; 2022 <strong>Aravinda Vishwanathapura</strong>.
        </p>
    </div>
</footer>

    </body>
</html>
