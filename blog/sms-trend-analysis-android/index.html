
<!DOCTYPE HTML>
<html lang="en">
    <head>
    <meta charset="utf-8">
    
    <title>SMS trend analysis - Android - Aravinda Vishwanathapura</title>
    
    <meta name="generator" content="Nanoc 4.12.20">
    <link rel="apple-touch-icon" sizes="300x300" href="/images/me_fav.png">
    <link rel="icon" type="image/png" sizes="300x300" href="/images/me_fav.png">
    <link rel="stylesheet" href="/bulma-0.9.4.min.css">
    <link rel="stylesheet" href="/pygment-emacs-highlight.css">
    <link rel="stylesheet" href="/stylesheet.css">
    <script defer src="/alpinejs-3.10.5.min.js"></script>
    
    <meta property="og:title" content="SMS trend analysis - Android"/>
    <meta name="author" content=""/>
    <meta property="og:locale" content="en_US"/>
    <meta name="description" content="Now a days my incoming and outgoing SMS trend looks like this for some reason :)"/>
    <meta property="og:description" content="Now a days my incoming and outgoing SMS trend looks like this for some reason :)"/>
    <link rel="canonical" href="/blog/sms-trend-analysis-android/"/>
    <meta property="og:url" content="/blog/sms-trend-analysis-android/"/>
    <meta property="og:site_name" content="Aravinda Vishwanathapura"/>
    <meta property="og:type" content="article"/>
    <meta property="article:published_time" content="2013-04-09"/>
    
    <meta name="twitter:card" content="summary"/>
    <meta property="og:image" content="https://aravindavk.in/images/me.jpg"/>
    <meta name="twitter:image" content="https://aravindavk.in/images/me.jpg"/>
    
    <meta name="twitter:site" content="https://aravindavk.in"/>
    <meta name="twitter:title" content="SMS trend analysis - Android"/>
    <meta name="twitter:description" content="Now a days my incoming and outgoing SMS trend looks like this for some reason :)"/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script defer data-domain="aravindavk.in" src="https://plausible.io/js/plausible.js"></script>
</head>

    <body>
        <div id="main" class="container is-max-desktop px-4">
            <nav class="has-text-centered mb-6">
    <a class="link is-info is-inline-block px-2" href="/blog">Blog Posts</a>
    <a class="link is-info is-inline-block px-2" href="/talks-articles">Talks & Articles</a>
    <a class="link is-info is-inline-block px-2" href="/projects">Projects</a>
</nav>
<div class="has-text-centered py-6">
    <a href="/">
        <figure class="image is-64x64" style="margin: auto">
            <img class="is-rounded" src="/images/me.jpg">
        </figure>
        <p class="has-text-grey pb-6 is-size-6">ARAVINDA VISHWANATHAPURA</p>
    </a>
</div>

            <div class="has-text-centered">
                <h1 class="title">SMS trend analysis - Android</h1>
                <div class="">Apr 9, 2013</div>
                <div class="">
                    <span class="icon-text">
                        <svg class="mr-1 icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path></svg>
                        <span><strong>4 minutes</strong> read.</span>
                    </span>
                </div>
                <div>
                    
                    <span class="tag is-info is-light">english</span>
                    
                    <span class="tag is-info is-light">sms</span>
                    
                    <span class="tag is-info is-light">android</span>
                    
                    <span class="tag is-info is-light">sql</span>
                    
                </div>
            </div>
            <div class="content py-6">
                <div class="paragraph">
<p>Now a days my incoming and outgoing SMS trend looks like this for some(known) reason :)</p>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/incoming_sms_trend.png" alt="Incoming sms trend">
</div>
<div class="title">Incoming SMS trend(Nov 2012 - Apr 2013)</div>
</div>
<div class="imageblock">
<div class="content">
<img src="/images/outgoing_sms_trend.png" alt="Outgoing sms trend">
</div>
<div class="title">Outgoing SMS trend(Nov 2012 - Apr 2013)</div>
</div>
<div class="paragraph">
<p><strong>PS</strong>: Sometimes I delete telemarketing SMS as and when I receive, so incoming trend may not show actual :) Also while playing with Android OS I lost all the SMS prior to Nov 2012.</p>
</div>
<div class="paragraph">
<p>***</p>
</div>
<div class="paragraph">
<p>Continue reading if you are wondering how I extracted the SMS data from the phone.</p>
</div>
<div class="sect1">
<h2 id="_prerequisites">prerequisites:</h2>
<div class="sectionbody">
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Android phone</p>
</li>
<li>
<p>Your Android phone should be rooted one.</p>
</li>
<li>
<p>Android SDK should be installed.</p>
</li>
<li>
<p>Debugging should be enabled in your android phone.</p>
</li>
</ol>
</div>
</div>
</div>
<div class="sect1">
<h2 id="_idea">Idea:</h2>
<div class="sectionbody">
<div class="paragraph">
<p>In Android, SMS data is stored in sqlite database, and it is located in the following directory(in phone).</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">/data/data/com.android.providers.telephony/databases/mmssms.db</code></pre>
</div>
</div>
<div class="paragraph">
<p>So we can run sql queries to get the details from sms table as per our need. To access the data from db, Android phone should be rooted.</p>
</div>
<div class="paragraph">
<p>Add <code>adb</code> path(in my machine adb path is <code>/home/aravinda/android-sdk/platform-tools/</code>) to environment variable PATH, and run <code>adb</code> as root.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">adb root</code></pre>
</div>
</div>
<div class="paragraph">
<p>In sqlite we can see the list of tables present in a database using <code>.tables</code> (<code>sqlite3 &lt;db path&gt; ".tables"</code>) query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">adb shell <span class="s1">'sqlite3 /data/data/com.android.providers.telephony/databases/mmssms.db ".tables"'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>and we can get schema of the required sqlite table using <code>.schema &lt;table name&gt;</code> query.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">adb shell <span class="s1">'sqlite3 /data/data/com.android.providers.telephony/databases/mmssms.db ".schema sms"'</span></code></pre>
</div>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">    <span class="k">CREATE</span> <span class="k">TABLE</span> <span class="n">sms</span>
    <span class="p">(</span>
        <span class="n">_id</span>                <span class="nb">INTEGER</span> <span class="k">PRIMARY</span> <span class="k">KEY</span><span class="p">,</span>
        <span class="n">thread_id</span>          <span class="nb">INTEGER</span><span class="p">,</span>
        <span class="n">address</span>            <span class="nb">TEXT</span><span class="p">,</span>
        <span class="n">person</span>             <span class="nb">INTEGER</span><span class="p">,</span>
        <span class="nb">date</span>               <span class="nb">INTEGER</span><span class="p">,</span>
        <span class="n">date_sent</span>          <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">protocol</span>           <span class="nb">INTEGER</span><span class="p">,</span>
        <span class="k">read</span>               <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">status</span>             <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span>
        <span class="k">type</span>               <span class="nb">INTEGER</span><span class="p">,</span>
        <span class="n">reply_path_present</span> <span class="nb">INTEGER</span><span class="p">,</span>
        <span class="n">subject</span>            <span class="nb">TEXT</span><span class="p">,</span>
        <span class="n">body</span>               <span class="nb">TEXT</span><span class="p">,</span>
        <span class="n">service_center</span>     <span class="nb">TEXT</span><span class="p">,</span>
        <span class="n">locked</span>             <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">error_code</span>         <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span><span class="p">,</span>
        <span class="n">seen</span>               <span class="nb">INTEGER</span> <span class="k">DEFAULT</span> <span class="mi">0</span>
    <span class="p">);</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>Now we know how to run queries inside phone using <code>adb</code>, let us list down some of the ideas which we can implement using available sms data.</p>
</div>
<div class="olist arabic">
<ol class="arabic">
<li>
<p>Number of SMS sent/received per day, to see the trend or if you have number of SMS limit per day/month.</p>
</li>
<li>
<p>SMS sent/received trend per hour, to see what time of the day I spend more in sending/receiving SMS.</p>
</li>
<li>
<p>Number of SMS per day per number, to see the trend per number.</p>
</li>
<li>
<p>Identify the messages/number to which I never interacted.</p>
</li>
<li>
<p>Identify the trend of teledirect numbers(Regex for non number phone number).</p>
</li>
<li>
<p>Backup all SMS database.</p>
</li>
<li>
<p>SMS book/conversations book.</p>
</li>
<li>
<p>Check how many sent messages are just less than 10 chars.</p>
</li>
<li>
<p>Live SMS notification in Laptop/Computer.</p>
</li>
</ol>
</div>
<div class="paragraph">
<p><strong>The only limitation is your imagination :D</strong></p>
</div>
<div class="paragraph">
<p><strong>Example</strong>: Number of sms sent per day.</p>
</div>
<div class="paragraph">
<p>Query is</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">    <span class="k">SELECT</span> <span class="n">STRFTIME</span><span class="p">(</span><span class="nv">"%Y%m%d"</span><span class="p">,</span> <span class="nb">DATETIME</span><span class="p">(</span><span class="nb">date</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="nv">"unixepoch"</span><span class="p">,</span> <span class="nv">"localtime"</span><span class="p">))</span> <span class="n">dte</span><span class="p">,</span>
           <span class="k">COUNT</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span>
    <span class="k">FROM</span> <span class="n">sms</span>
    <span class="k">WHERE</span> <span class="k">type</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dte</span>
    <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dte</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>where type 2 is sent and 1 is received.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash">adb shell <span class="s1">'sqlite3 /data/data/com.android.providers.telephony/databases/mmssms.db \
  "SELECT STRFTIME(\"%Y%m%d\", DATETIME(date/1000, \"unixepoch\", \"localtime\")) dte,  \
  COUNT(_id) FROM sms WHERE type = 2 GROUP BY dte ORDER BY dte"'</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>If you want to find number of sms sent per day for a particular phone number then add the condition in WHERE clause as follows</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="sql">    <span class="k">SELECT</span> <span class="n">STRFTIME</span><span class="p">(</span><span class="nv">"%Y%m%d"</span><span class="p">,</span> <span class="nb">DATETIME</span><span class="p">(</span><span class="nb">date</span><span class="o">/</span><span class="mi">1000</span><span class="p">,</span> <span class="nv">"unixepoch"</span><span class="p">,</span> <span class="nv">"localtime"</span><span class="p">))</span> <span class="n">dte</span><span class="p">,</span>
           <span class="k">COUNT</span><span class="p">(</span><span class="n">_id</span><span class="p">)</span>
    <span class="k">FROM</span> <span class="n">sms</span>
    <span class="k">WHERE</span> <span class="k">type</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="k">GROUP</span> <span class="k">BY</span> <span class="n">dte</span>
    <span class="k">ORDER</span> <span class="k">BY</span> <span class="n">dte</span>
    <span class="k">AND</span> <span class="k">REPLACE</span><span class="p">(</span><span class="k">REPLACE</span><span class="p">(</span><span class="n">address</span><span class="p">,</span> <span class="nv">"+91"</span><span class="p">,</span><span class="nv">""</span><span class="p">),</span> <span class="nv">" "</span><span class="p">,</span> <span class="nv">""</span><span class="p">)</span> <span class="o">=</span> <span class="nv">"XXXXX"</span></code></pre>
</div>
</div>
<div class="paragraph">
<p>I created <a href="https://gist.github.com/aravindavk/5339192">Python script</a> to extract data as described above. Additionally script generates csv output which can be used to plot as required. Use any familiar library(Matplotlib, PhantomJS and d3, flot etc..) or just use Spreadsheet to plot the graph as required. I used Libreoffice Calc to create these charts.</p>
</div>
<div class="paragraph">
<p>Let me know if you find this blog useful and need any help in writing SQL queries :)</p>
</div>
</div>
</div>
            </div>
            <div class="has-text-centered mb-6 notification  is-light">
    
    <p class="has-text-grey is-uppercase is-size-5 pb-2">About Aravinda Vishwanathapura</p>
    
    Co-Founder & CTO at <a href="https://kadalu.tech">Kadalu Technologies</a>,
    Creator of <a href="https://aravindavk.in/sanka">Sanka</a>,
    Creator of <a href="https://aravindavk.in/chitra">Chitra</a>,
    <a href="https://gluster.org">GlusterFS</a> core team member,
    Maintainer of <a href="https://github.com/kadalu">Kadalu Storage</a>
    <div class="mt-6">
        Contact:
        <a href="http://in.linkedin.com/in/aravindavk">Linkedin</a> |
        <a href="https://twitter.com/aravindavk">Twitter</a> |
        <a href="http://facebook.com/aravindavk">Facebook</a> |
        <a href="https://github.com/aravindavk">Github</a> |
        mail&#64;&#97;&#114;&#97;&#118;&#105;&#110;&#100;&#97;&#118;&#107;&#46;&#105;&#110;
    </div>
</div>

        </div>
        <footer class="footer has-background-white-bis mt-6">
    <div class="content has-text-centered">
        <p>
            Copyright &copy; 2022 <strong>Aravinda Vishwanathapura</strong>.
        </p>
    </div>
</footer>

    </body>
</html>
