
<!DOCTYPE HTML>
<html lang="en">
    <head>
    <meta charset="utf-8">
    
    <title>10 minutes introduction to Gluster Eventing Feature - Aravinda Vishwanathapura</title>
    
    <meta name="generator" content="Nanoc 4.12.10">
    <link rel="apple-touch-icon" sizes="300x300" href="/images/me_fav.png">
    <link rel="icon" type="image/png" sizes="300x300" href="/images/me_fav.png">
    <link rel="stylesheet" href="/bulma-0.9.4.min.css">
    <link rel="stylesheet" href="/pygment-emacs-highlight.css">
    <link rel="stylesheet" href="/stylesheet.css">
    <script defer src="/alpinejs-3.10.5.min.js"></script>
    
    <meta property="og:title" content="10 minutes introduction to Gluster Eventing Feature"/>
    <meta name="author" content=""/>
    <meta property="og:locale" content="en_US"/>
    <meta name="description" content="It provides close to realtime notification and alerts for the Gluster cluster state changes."/>
    <meta property="og:description" content="It provides close to realtime notification and alerts for the Gluster cluster state changes."/>
    <link rel="canonical" href="/blog/10-mins-intro-to-gluster-eventing/"/>
    <meta property="og:url" content="/blog/10-mins-intro-to-gluster-eventing/"/>
    <meta property="og:site_name" content="Aravinda Vishwanathapura"/>
    <meta property="og:type" content="article"/>
    <meta property="article:published_time" content="2016-05-11"/>
    
    <meta name="twitter:card" content="summary"/>
    <meta property="og:image" content="https://aravindavk.in/images/me.jpg"/>
    <meta name="twitter:image" content="https://aravindavk.in/images/me.jpg"/>
    
    <meta name="twitter:site" content="https://aravindavk.in"/>
    <meta name="twitter:title" content="10 minutes introduction to Gluster Eventing Feature"/>
    <meta name="twitter:description" content="It provides close to realtime notification and alerts for the Gluster cluster state changes."/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script defer data-domain="aravindavk.in" src="https://plausible.io/js/plausible.js"></script>
</head>

    <body>
        <div id="main" class="container is-max-desktop px-4">
            <nav class="has-text-centered mb-6">
    <a class="link is-info is-inline-block px-2" href="/blog">Blog Posts</a>
    <a class="link is-info is-inline-block px-2" href="/talks-articles">Talks & Articles</a>
    <a class="link is-info is-inline-block px-2" href="/projects">Projects</a>
</nav>
<div class="has-text-centered py-6">
    <a href="/">
        <figure class="image is-64x64" style="margin: auto">
            <img class="is-rounded" src="/images/me.jpg">
        </figure>
        <p class="has-text-grey pb-6 is-size-6">ARAVINDA VISHWANATHAPURA</p>
    </a>
</div>

            <div class="has-text-centered">
                <h1 class="title">10 minutes introduction to Gluster Eventing Feature</h1>
                <div class="">May 11, 2016</div>
                <div class=""><strong>5 minutes</strong> read</div>
                <div>
                    
                    <span class="tag is-info is-light">gluster</span>
                    
                    <span class="tag is-info is-light"> glusterfsblog</span>
                    
                </div>
            </div>
            <div class="content py-6">
                <div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>raw:: html</p>
<div class="literalblock">
<div class="content">
<pre>&lt;div class="notice-update"&gt;
Demo video is included in the end, or you can directly watch it on &lt;a href="https://www.youtube.com/watch?v=urzong5sKqc"&gt;Youtube&lt;/a&gt;
&lt;/div&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Gluster Eventing is the new feature as part of Gluster.Next
initiatives, it provides close to realtime notification and alerts for
the Gluster cluster state changes.</p>
</div>
<div class="paragraph">
<p>Websockets APIs to consume events will be added later. Now we emit
events via another popular mechanism called "Webhooks".(Many popular
products provide notifications via Webhooks `Github,
&lt;<a href="https://developer.github.com/webhooks/&gt;`" class="bare">https://developer.github.com/webhooks/&gt;`</a><em> `Atlassian,
&lt;<a href="https://developer.atlassian.com/jiradev/jira-apis/webhooks&gt;`" class="bare">https://developer.atlassian.com/jiradev/jira-apis/webhooks&gt;`</a></em>
`Dropbox, &lt;<a href="https://www.dropbox.com/developers/reference/webhooks&gt;`__" class="bare">https://www.dropbox.com/developers/reference/webhooks&gt;`__</a> and many more)</p>
</div>
<div class="paragraph">
<p><strong>Webhooks</strong> are similar to callbacks(over HTTP), on event Gluster will
call the Webhook URL(via POST) which is configured. Webhook is a web server
which listens on a URL, this can be deployed outside of the
Cluster. Gluster nodes should be able to access this Webhook server on
the configured port. We will discuss about adding/testing webhook
later.</p>
</div>
<div class="paragraph">
<p>Example Webhook written in python,</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>code-block:: python</p>
<div class="literalblock">
<div class="content">
<pre>from flask import Flask, request</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>app = Flask(__name__)</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>@app.route("/listen", methods=["POST"])
def events_listener():
    gluster_event = request.json
    if gluster_event is None:
        # No event to process, may be test call
        return "OK"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre># Process gluster_event
# {
#  "nodeid": NODEID,
#  "ts": EVENT_TIMESTAMP,
#  "event": EVENT_TYPE,
#  "message": EVENT_DATA
# }
return "OK"</pre>
</div>
</div>
<div class="literalblock">
<div class="content">
<pre>app.run(host="0.0.0.0", port=9000)</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Eventing feature is not yet available in any of the releases, patch is
under review in upstream master(<a href="http://review.gluster.org/14248" class="bare">http://review.gluster.org/14248</a>). If anybody interested in trying it
out can cherrypick the patch from review.gluster.org</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>code-block:: bash</p>
<div class="literalblock">
<div class="content">
<pre>git clone http://review.gluster.org/glusterfs
cd glusterfs
git fetch http://review.gluster.org/glusterfs refs/changes/48/14248/5
git checkout FETCH_HEAD
git checkout -b &lt;YOUR_BRANCH_NAME&gt;
./autogen.sh
./configure
make
make install</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Start the Eventing using,</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>code-block:: bash</p>
<div class="literalblock">
<div class="content">
<pre>gluster-eventing start</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Other commands available are stop, restart, reload and
status. <code>gluster-eventing --help</code> for more details.</p>
</div>
<div class="paragraph">
<p>Now Gluster can send out notifications via Webhooks. Setup a web
server listening to a POST request and register that URL to Gluster
Eventing. Thats all.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>code-block:: bash</p>
<div class="literalblock">
<div class="content">
<pre>gluster-eventing webhook-add &lt;MY_WEB_SERVER_URL&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>For example, if my webserver is running at <code><a href="http://192.168.122.188:9000/listen" class="bare">http://192.168.122.188:9000/listen</a></code>
then register using,</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>code-block:: bash</p>
<div class="literalblock">
<div class="content">
<pre>gluster-eventing webhook-add ``http://192.168.122.188:9000/listen``</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>We can also test if web server is accessible from all Gluster nodes
using <code>webhook-test</code> subcommand.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>code-block:: bash</p>
<div class="literalblock">
<div class="content">
<pre>gluster-eventing webhook-test http://192.168.122.188:9000/listen</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>With the initial patch only basic events are covered, I will add more
events once this patch gets merged. Following events are available
now.</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>code-block:: text</p>
<div class="literalblock">
<div class="content">
<pre>Volume Create
Volume Delete
Volume Start
Volume Stop
Peer Attach
Peer Detach</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Created a small demo to show this eventing feature, it uses Web server
which is included with the patch for Testing.(laptop hostname is <code>sonne</code>)</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>code-block:: bash</p>
<div class="literalblock">
<div class="content">
<pre>/usr/share/glusterfs/scripts/eventsdash.py --port 8080</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Login to Gluster node and start the eventing,</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>code-block:: bash</p>
<div class="literalblock">
<div class="content">
<pre>gluster-eventing start
gluster-eventing webhook-add http://sonne:8080/listen</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>And then login to VM and run Gluster commands to probe/detach peer,
volume create, start etc and Observe the realtime notifications for
the same where eventsdash is running.</p>
</div>
<div class="paragraph">
<p>Example,</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>code-block:: bash</p>
<div class="literalblock">
<div class="content">
<pre>ssh root@fvm1
gluster peer attach fvm2
gluster volume create gv1 fvm1:/bricks/b1 fvm2:/bricks/b2 force
gluster volume start gv1
gluster volume stop gv1
gluster volume delete gv1
gluster peer detach fvm2</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="paragraph">
<p>Demo also includes a Web UI which refreshes its UI automatically when
something changes in Cluster.(I am still fine tuning this UI, not yet
available with the patch. But soon will be available as seperate repo
in my github)</p>
</div>
<div class="olist loweralpha">
<ol class="loweralpha" type="a">
<li>
<p>raw:: html</p>
<div class="literalblock">
<div class="content">
<pre>&lt;iframe width="640" height="360" src="https://www.youtube.com/embed/urzong5sKqc" frameborder="0" allowfullscreen&gt;&lt;/iframe&gt;</pre>
</div>
</div>
</li>
</ol>
</div>
<div class="sect1">
<h2 id="_faq">FAQ:</h2>
<div class="sectionbody">
<div class="ulist">
<ul>
<li>
<p><strong>Will this feature available in 3.8 release?</strong></p>
<div class="literalblock">
<div class="content">
<pre>Sadly No. I couldn't get this merged before 3.8 feature freeze :(</pre>
</div>
</div>
</li>
<li>
<p><strong>Is it possible to create a simple Gluster dashboard outside the
cluster?</strong></p>
<div class="literalblock">
<div class="content">
<pre>It is possible, along with the events we also need REST APIs to get
more information from cluster or to perform any action in cluster.
(WIP REST APIs are available `here &lt;https://github.com/aravindavk/glusterfs-restapi&gt;`__)</pre>
</div>
</div>
</li>
<li>
<p><strong>Is it possible to filter only alerts or critical notifications?</strong></p>
<div class="literalblock">
<div class="content">
<pre>Thanks `Kotresh &lt;http://hrkscribbles.blogspot.in/&gt;`__ for the
suggestion. Yes it is possible to add event_type and event_group
information to the dict so that it can be filtered easily.(Not yet
available now, but will add this feature once this patch gets merged
in Master)</pre>
</div>
</div>
</li>
<li>
<p><strong>Is documentation available to know more about eventing design and
internals?</strong></p>
<div class="literalblock">
<div class="content">
<pre>Design spec available `here &lt;http://review.gluster.org/13115&gt;`__
(which discusses about Websockets, currently we don't have
Websockets support). Usage documentation is available in the commit
message of the patch(http://review.gluster.org/14248).</pre>
</div>
</div>
</li>
</ul>
</div>
<div class="paragraph">
<p>Comments and Suggestions Welcome.</p>
</div>
</div>
</div>
            </div>
        </div>
        <footer class="footer has-background-white-bis mt-6">
    <div class="content has-text-centered">
        <p>
            Copyright &copy; 2022 <strong>Aravinda Vishwanathapura</strong>.
        </p>
    </div>
</footer>

    </body>
</html>
