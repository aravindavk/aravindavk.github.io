
<!DOCTYPE HTML>
<html lang="en">
    <head>
    <meta charset="utf-8">
    
    <title>Protect the Gluster FS mount directory - Aravinda Vishwanathapura</title>
    
    <meta name="generator" content="Nanoc 4.12.20">
    <link rel="apple-touch-icon" sizes="300x300" href="/images/me_fav.png">
    <link rel="icon" type="image/png" sizes="300x300" href="/images/me_fav.png">
    <link rel="stylesheet" href="/bulma-0.9.4.min.css">
    <link rel="stylesheet" href="/pygment-emacs-highlight.css">
    <link rel="stylesheet" href="/stylesheet.css">
    <script defer src="/alpinejs-3.10.5.min.js"></script>
    
    <meta property="og:title" content="Protect the Gluster FS mount directory"/>
    <meta name="author" content=""/>
    <meta property="og:locale" content="en_US"/>
    <meta name="description" content="When the applications use the mount path to store the files, it may happen that the mount process may have crashed and the application continues to create the files in the root partition itself."/>
    <meta property="og:description" content="When the applications use the mount path to store the files, it may happen that the mount process may have crashed and the application continues to create the files in the root partition itself."/>
    <link rel="canonical" href="/blog/protect-glusterfs-mount/"/>
    <meta property="og:url" content="/blog/protect-glusterfs-mount/"/>
    <meta property="og:site_name" content="Aravinda Vishwanathapura"/>
    <meta property="og:type" content="article"/>
    <meta property="article:published_time" content="2024-03-19"/>
    
    <meta name="twitter:card" content="summary"/>
    <meta property="og:image" content="https://aravindavk.in/images/me.jpg"/>
    <meta name="twitter:image" content="https://aravindavk.in/images/me.jpg"/>
    
    <meta name="twitter:site" content="https://aravindavk.in"/>
    <meta name="twitter:title" content="Protect the Gluster FS mount directory"/>
    <meta name="twitter:description" content="When the applications use the mount path to store the files, it may happen that the mount process may have crashed and the application continues to create the files in the root partition itself."/>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script defer data-domain="aravindavk.in" src="https://plausible.io/js/plausible.js"></script>
</head>

    <body>
        <div id="main" class="container is-max-desktop px-4">
            <nav class="has-text-centered mb-6">
    <a class="link is-info is-inline-block px-2" href="/blog">Blog Posts</a>
    <a class="link is-info is-inline-block px-2" href="/talks-articles">Talks & Articles</a>
    <a class="link is-info is-inline-block px-2" href="/projects">Projects</a>
</nav>
<div class="has-text-centered py-6">
    <a href="/">
        <figure class="image is-64x64" style="margin: auto">
            <img class="is-rounded" src="/images/me.jpg">
        </figure>
        <p class="has-text-grey pb-6 is-size-6">ARAVINDA VISHWANATHAPURA</p>
    </a>
</div>

            <div class="has-text-centered">
                <h1 class="title">Protect the Gluster FS mount directory</h1>
                <div class="">Mar 19, 2024</div>
                <div class="">
                    <span class="icon-text">
                        <svg class="mr-1 icon" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" clip-rule="evenodd"></path></svg>
                        <span><strong>1 minute</strong> read.</span>
                    </span>
                </div>
                <div>
                    
                    <span class="tag is-info is-light">glusterfs</span>
                    
                </div>
            </div>
            <div class="content py-6">
                <div class="paragraph">
<p>When the applications use the mount path to store the files, it may happen that the mount process may have crashed and the application continues to create the files in the root partition itself. Check the example below to understand the issue</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Create the mount directory</span>
<span class="nb">mkdir</span> /mnt/vol1

<span class="c"># Mount the Glusterfs Volume</span>
mount <span class="nt">-t</span> glusterfs server1.gluster:/vol1 /mnt/vol1

<span class="c"># Application creating the file</span>
<span class="nb">echo</span> <span class="s2">"Hello World!"</span> <span class="o">&gt;</span> /mnt/vol1/file1

<span class="c"># Now simulate the mount crash by killing</span>
<span class="c"># the `glusterfs` process or by</span>
<span class="c"># unmounting the volume.</span>
umount /mnt/vol1

<span class="c"># Application creating or updating the file</span>
<span class="nb">echo</span> <span class="s2">"Hello Again!"</span> <span class="o">&gt;</span> /mnt/vol1/file2</code></pre>
</div>
</div>
<div class="paragraph">
<p>In the above example, the file (file2) was not created on the Gluster FS volume. This is a serious problem. To protect the mount directory, make it immutable before mounting it.</p>
</div>
<div class="listingblock">
<div class="content">
<pre class="rouge highlight"><code data-lang="bash"><span class="c"># Create the mount directory</span>
<span class="nb">mkdir</span> /mnt/vol1

<span class="c"># Make the directory immutable</span>
chattr +i /mnt/vol1

<span class="c"># Mount the Glusterfs Volume</span>
mount <span class="nt">-t</span> glusterfs server1.gluster:/vol1 /mnt/vol1

<span class="c"># Application creating the file</span>
<span class="nb">echo</span> <span class="s2">"Hello World!"</span> <span class="o">&gt;</span> /mnt/vol1/file1

<span class="c"># Now simulate the mount crash by killing</span>
<span class="c"># the `glusterfs` process or by</span>
<span class="c"># unmounting the volume.</span>
umount /mnt/vol1

<span class="c"># Application creating or updating the file</span>
<span class="c"># This command will fail now.</span>
<span class="nb">echo</span> <span class="s2">"Hello Again!"</span> <span class="o">&gt;</span> /mnt/vol1/file2</code></pre>
</div>
</div>
            </div>
            <div class="has-text-centered mb-6 notification  is-light">
    
    <p class="has-text-grey is-uppercase is-size-5 pb-2">About Aravinda Vishwanathapura</p>
    
    Co-Founder & CTO at <a href="https://kadalu.tech">Kadalu Technologies</a>,
    Creator of <a href="https://aravindavk.in/sanka">Sanka</a>,
    Creator of <a href="https://aravindavk.in/chitra">Chitra</a>,
    <a href="https://gluster.org">GlusterFS</a> core team member,
    Maintainer of <a href="https://github.com/kadalu">Kadalu Storage</a>
    <div class="mt-6">
        Contact:
        <a href="http://in.linkedin.com/in/aravindavk">Linkedin</a> |
        <a href="https://twitter.com/aravindavk">Twitter</a> |
        <a href="http://facebook.com/aravindavk">Facebook</a> |
        <a href="https://github.com/aravindavk">Github</a> |
        mail&#64;&#97;&#114;&#97;&#118;&#105;&#110;&#100;&#97;&#118;&#107;&#46;&#105;&#110;
    </div>
</div>

        </div>
        <footer class="footer has-background-white-bis mt-6">
    <div class="content has-text-centered">
        <p>
            Copyright &copy; 2022 <strong>Aravinda Vishwanathapura</strong>.
        </p>
    </div>
</footer>

    </body>
</html>
